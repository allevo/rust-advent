name: Post To PR

on:
  workflow_run:
    workflows: ["Valgrind Benchmarks"]
    types: [completed]

jobs:
  on-success:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - uses: actions/checkout@v2
        with:
          ref: ${{ github.event.workflow_run.head_branch }}

      - name: Download artifact
        uses: dawidd6/action-download-artifact@v2
        with:
          github_token: ${{secrets.GITHUB_TOKEN}}
          workflow: ${{ github.event.workflow.id }}
          # Optional, will use specified workflow run
          # run_id: 1122334455
          # name: artifact_name
          
      - run: ls

      - name: "Post to PR"
        uses: malagolichiara/comment-on-pr@master
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          pull_request_number: 21
          check_for_duplicate_msg: true
          msg: |
            ## Valgrind Benchmarks
            http://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}
            
            Test

#   on-failure:
#     runs-on: ubuntu-latest
#     if: ${{ github.event.workflow_run.conclusion == 'failure' }}
#     steps:
#       ...
